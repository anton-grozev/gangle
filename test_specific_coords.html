<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <title>–¢–µ—Å—Ç –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ç–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –æ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ</title>
    <script src="GAngle.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
            background: #f8f9fa;
        }
        .test-box {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 15px;
        }
        h2 {
            color: #34495e;
            margin-top: 30px;
        }
        .params {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-family: monospace;
        }
        .result {
            background: #e8f5e9;
            padding: 20px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 4px solid #4caf50;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .method {
            padding: 15px;
            border-radius: 5px;
            border: 2px solid #ddd;
        }
        .method-wrong {
            background: #ffebee;
            border-color: #f44336;
        }
        .method-correct {
            background: #e8f5e9;
            border-color: #4caf50;
        }
        .difference {
            background: #fff3cd;
            padding: 20px;
            border-radius: 5px;
            border-left: 4px solid #ff9800;
            margin: 20px 0;
            font-size: 18px;
            font-weight: bold;
        }
        .conclusion {
            background: #e3f2fd;
            padding: 25px;
            border-radius: 8px;
            border-left: 4px solid #2196f3;
            margin: 30px 0;
            font-size: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border: 1px solid #ddd;
        }
        th {
            background: #3498db;
            color: white;
        }
        .highlight {
            background: #fff59d;
            padding: 2px 5px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <h1>üî¨ –¢–µ—Å—Ç: –ù–µ–æ–±—Ö–æ–¥–∏–º –ª–∏ –µ wrapper –∑–∞ –í–ê–®–ò–¢–ï –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏?</h1>
    
    <div class="test-box">
        <h2>üìã –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –æ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ</h2>
        <div class="params">
l = 85 mm<br>
d = 5.7 mm<br>
Œ∏ = 61¬∞ (‚âà 1.0647 rad)<br>
Œ≤ = 24¬∞ (‚âà 0.4189 rad)<br>
<br>
<strong>SW –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ (–ø–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—Ç–∞ —Ñ–æ—Ä–º–∞):</strong><br>
x_sw = 0 mm<br>
y_sw = 4.84 mm<br>
z_sw = -9.75 mm
        </div>
    </div>

    <div class="test-box">
        <h2>üîÑ –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è SW ‚Üí M</h2>
        <div id="transformation"></div>
    </div>

    <div class="test-box">
        <h2>‚öñÔ∏è –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –Ω–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ</h2>
        <div class="comparison">
            <div class="method method-wrong">
                <h3>‚ùå –ë–ï–ó wrapper</h3>
                <p>–î–∏—Ä–µ–∫—Ç–Ω–æ –ø–æ–¥–∞–≤–∞–Ω–µ –Ω–∞ SW –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –∫–∞—Ç–æ M</p>
                <div id="without-wrapper"></div>
            </div>
            <div class="method method-correct">
                <h3>‚úÖ –° wrapper</h3>
                <p>–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è SW ‚Üí M –ø—Ä–µ–¥–∏ –∏–∑—á–∏—Å–ª–µ–Ω–∏–µ</p>
                <div id="with-wrapper"></div>
            </div>
        </div>
        <div id="difference"></div>
    </div>

    <div class="test-box">
        <h2>üìä –î–µ—Ç–∞–π–ª–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞</h2>
        <div id="detailed-table"></div>
    </div>

    <div class="conclusion" id="conclusion"></div>

    <script>
        const calc = DrillAngleCalculator;

        // –ü–∞—Ä–∞–º–µ—Ç—Ä–∏
        const l = 85;
        const d = 5.7;
        const theta = calc.deg2rad(61);
        const beta = calc.deg2rad(24);
        
        // SW –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –æ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ
        const x_sw = 0;
        const y_sw = 4.84;
        const z_sw = -9.75;

        // 1. –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è
        const M11 = -0.1747159967, M12 = 0.6235799837, M13 = -0.1867561927;
        const M21 = 0.3122687596, M22 = -0.1413437982, M23 = 0.8581431812;
        const M31 = 0.8697589148, M32 = -0.1087945740, M33 = -0.4267759731;
        
        const xM = M11 * x_sw + M12 * y_sw + M13 * z_sw;
        const yM = M21 * x_sw + M22 * y_sw + M23 * z_sw;
        const zM = M31 * x_sw + M32 * y_sw + M33 * z_sw;

        document.getElementById('transformation').innerHTML = `
            <p><strong>–ò–∑—Ö–æ–¥–Ω–∏ SW –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏:</strong></p>
            <div class="params">
                x_sw = ${x_sw} mm<br>
                y_sw = ${y_sw} mm<br>
                z_sw = ${z_sw} mm
            </div>
            
            <p><strong>–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä–∞–Ω–∏ M –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏:</strong></p>
            <div class="result">
                x<sub>M</sub> = ${xM.toFixed(6)} mm<br>
                y<sub>M</sub> = ${yM.toFixed(6)} mm<br>
                z<sub>M</sub> = ${zM.toFixed(6)} mm
            </div>
            
            <p style="margin-top: 20px;">
                ${Math.abs(x_sw - xM) < 0.001 && Math.abs(y_sw - yM) < 0.001 && Math.abs(z_sw - zM) < 0.001 
                    ? '<span class="highlight">‚úì SW –∏ M —Å–∞ –µ–¥–Ω–∞–∫–≤–∏ - wrapper –ù–ï –µ –Ω–µ–æ–±—Ö–æ–¥–∏–º</span>' 
                    : '<span class="highlight">‚ö†Ô∏è SW –∏ M —Å–∞ –†–ê–ó–õ–ò–ß–ù–ò - wrapper –ï –ù–ï–û–ë–•–û–î–ò–ú!</span>'}
            </p>
        `;

        // 2. –ò–∑—á–∏—Å–ª–µ–Ω–∏–µ –ë–ï–ó wrapper (–≥—Ä–µ—à–Ω–æ)
        try {
            const result1 = calc.calculateAngle(l, d, theta, beta, x_sw, y_sw, z_sw);
            document.getElementById('without-wrapper').innerHTML += `
                <div class="result">
                    <strong>Œ±<sub>f</sub> = ${result1.alphaRAD.toFixed(4)}¬∞</strong><br>
                    h = ${result1.h.toFixed(4)} mm<br>
                    x<sub>M</sub> = ${result1.xM.toFixed(4)} mm
                </div>
            `;
        } catch (error) {
            document.getElementById('without-wrapper').innerHTML += `
                <div style="color: red;">–ì—Ä–µ—à–∫–∞: ${error.message}</div>
            `;
        }

        // 3. –ò–∑—á–∏—Å–ª–µ–Ω–∏–µ –° wrapper (–ø—Ä–∞–≤–∏–ª–Ω–æ)
        try {
            const result2 = calc.calculateAngleFromSW(l, d, theta, beta, x_sw, y_sw, z_sw);
            document.getElementById('with-wrapper').innerHTML += `
                <div class="result">
                    <strong>Œ±<sub>f</sub> = ${result2.alphaRAD.toFixed(4)}¬∞</strong><br>
                    h = ${result2.h.toFixed(4)} mm<br>
                    x<sub>M</sub> = ${result2.xM.toFixed(4)} mm
                </div>
            `;
        } catch (error) {
            document.getElementById('with-wrapper').innerHTML += `
                <div style="color: red;">–ì—Ä–µ—à–∫–∞: ${error.message}</div>
            `;
        }

        // 4. –†–∞–∑–ª–∏–∫–∞
        const result1 = calc.calculateAngle(l, d, theta, beta, x_sw, y_sw, z_sw);
        const result2 = calc.calculateAngleFromSW(l, d, theta, beta, x_sw, y_sw, z_sw);
        
        const diffAlpha = Math.abs(result1.alphaRAD - result2.alphaRAD);
        const diffH = Math.abs(result1.h - result2.h);
        const diffXM = Math.abs(result1.xM - result2.xM);

        document.getElementById('difference').innerHTML = `
            <div class="difference">
                üìè –†–ê–ó–õ–ò–ö–ò –í –†–ï–ó–£–õ–¢–ê–¢–ò–¢–ï:<br>
                ŒîŒ±<sub>f</sub> = ${diffAlpha.toFixed(6)}¬∞ ${diffAlpha > 0.001 ? '‚ö†Ô∏è –ó–ù–ê–ß–ò–¢–ï–õ–ù–ê!' : '‚úì'}<br>
                Œîh = ${diffH.toFixed(6)} mm ${diffH > 0.001 ? '‚ö†Ô∏è –ó–ù–ê–ß–ò–¢–ï–õ–ù–ê!' : '‚úì'}<br>
                Œîx<sub>M</sub> = ${diffXM.toFixed(6)} mm ${diffXM > 0.001 ? '‚ö†Ô∏è –ó–ù–ê–ß–ò–¢–ï–õ–ù–ê!' : '‚úì'}
            </div>
        `;

        // 5. –î–µ—Ç–∞–π–ª–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞
        document.getElementById('detailed-table').innerHTML = `
            <table>
                <thead>
                    <tr>
                        <th>–ú–µ—Ç–æ–¥</th>
                        <th>–í—Ö–æ–¥–Ω–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏</th>
                        <th>Œ±<sub>f</sub> (¬∞)</th>
                        <th>h (mm)</th>
                        <th>x<sub>M</sub> (mm)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr style="background: #ffebee;">
                        <td><strong>–ë–ï–ó wrapper</strong></td>
                        <td>SW(${x_sw}, ${y_sw}, ${z_sw})</td>
                        <td>${result1.alphaRAD.toFixed(4)}</td>
                        <td>${result1.h.toFixed(4)}</td>
                        <td>${result1.xM.toFixed(4)}</td>
                    </tr>
                    <tr style="background: #e8f5e9;">
                        <td><strong>–° wrapper</strong></td>
                        <td>SW(${x_sw}, ${y_sw}, ${z_sw}) ‚Üí M(${xM.toFixed(2)}, ${yM.toFixed(2)}, ${zM.toFixed(2)})</td>
                        <td>${result2.alphaRAD.toFixed(4)}</td>
                        <td>${result2.h.toFixed(4)}</td>
                        <td>${result2.xM.toFixed(4)}</td>
                    </tr>
                </tbody>
            </table>
        `;

        // 6. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ
        if (diffAlpha > 0.001 || diffH > 0.001 || diffXM > 0.001) {
            document.getElementById('conclusion').innerHTML = `
                <h2>üéØ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï:</h2>
                <p style="font-size: 24px; color: #d32f2f;">
                    ‚úÖ Wrapper —Ñ—É–Ω–∫—Ü–∏—è—Ç–∞ <code>calculateAngleFromSW()</code> –ï –ê–ë–°–û–õ–Æ–¢–ù–û –ù–ï–û–ë–•–û–î–ò–ú–ê!
                </p>
                <p><strong>–ó–∞—â–æ?</strong></p>
                <ul style="font-size: 16px; line-height: 1.8;">
                    <li>–í–∏–µ –≤—ä–≤–µ–∂–¥–∞—Ç–µ SW –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏: (${x_sw}, ${y_sw}, ${z_sw})</li>
                    <li>–°–ª–µ–¥ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è —Ç–µ —Å—Ç–∞–≤–∞—Ç M –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏: (${xM.toFixed(2)}, ${yM.toFixed(2)}, ${zM.toFixed(2)})</li>
                    <li>–¢–µ–∑–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –°–ê –†–ê–ó–õ–ò–ß–ù–ò!</li>
                    <li>–†–∞–∑–ª–∏–∫–∞—Ç–∞ –≤ —Ä–µ–∑—É–ª—Ç–∞—Ç–∞ –∑–∞ Œ±<sub>f</sub> –µ ${diffAlpha.toFixed(4)}¬∞ - —Ç–æ–≤–∞ –µ –ó–ù–ê–ß–ò–¢–ï–õ–ù–û!</li>
                    <li><strong>–ë–µ–∑ wrapper –ø–æ–ª—É—á–∞–≤–∞—Ç–µ –ì–†–ï–®–ù–ò —Ä–µ–∑—É–ª—Ç–∞—Ç–∏!</strong></li>
                </ul>
                <p style="font-size: 18px; margin-top: 20px; padding: 15px; background: #fff59d; border-radius: 5px;">
                    üí° <strong>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—Ç–∞ —Ñ–æ—Ä–º–∞ –∏–∑–ø–æ–ª–∑–≤–∞ SW –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –∏ –∑–∞—Ç–æ–≤–∞ wrapper-—ä—Ç –µ –∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–µ–Ω –∑–∞ –ø—Ä–∞–≤–∏–ª–Ω–æ—Å—Ç—Ç–∞ –Ω–∞ –∏–∑—á–∏—Å–ª–µ–Ω–∏—è—Ç–∞!</strong>
                </p>
            `;
        } else {
            document.getElementById('conclusion').innerHTML = `
                <h2>üéØ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï:</h2>
                <p style="font-size: 24px; color: #388e3c;">
                    ‚ùå Wrapper —Ñ—É–Ω–∫—Ü–∏—è—Ç–∞ –ù–ï –ï –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞
                </p>
                <p>SW –∏ M –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏—Ç–µ —Å–∞ –µ–¥–Ω–∞–∫–≤–∏ –∑–∞ —Ç–µ–∑–∏ —Å—Ç–æ–π–Ω–æ—Å—Ç–∏.</p>
            `;
        }
    </script>
</body>
</html>
