<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∑–∞ SW vs M –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏</title>
    <script src="GAngle.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h2 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .result {
            background: #ecf0f1;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
        }
        .difference {
            background: #fff3cd;
            padding: 10px;
            margin: 10px 0;
            border-left: 4px solid #ffc107;
        }
        .same {
            background: #d4edda;
            padding: 10px;
            margin: 10px 0;
            border-left: 4px solid #28a745;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #3498db;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .conclusion {
            background: #e8f4f8;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #3498db;
            font-size: 18px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>üîç –¢–µ—Å—Ç: SW vs M –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–Ω–∏ —Å–∏—Å—Ç–µ–º–∏</h1>
    
    <div class="test-section">
        <h2>–¢–µ—Å—Ç 1: –ï–¥–Ω–∞–∫–≤–∏ –ª–∏ —Å–∞ SW –∏ M –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏—Ç–µ?</h2>
        <div id="test1"></div>
    </div>

    <div class="test-section">
        <h2>–¢–µ—Å—Ç 2: –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞ –º–∞—Ç—Ä–∏—Ü–∞</h2>
        <div id="test2"></div>
    </div>

    <div class="test-section">
        <h2>–¢–µ—Å—Ç 3: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –Ω–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏</h2>
        <div id="test3"></div>
    </div>

    <div class="test-section">
        <h2>–¢–µ—Å—Ç 4: –ù—É–ª–µ–≤–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏</h2>
        <div id="test4"></div>
    </div>

    <div id="conclusion" class="conclusion"></div>

    <script>
        // –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–ª–∏ SW = M
        function test1() {
            const testPoints = [
                {x_sw: 1, y_sw: 0, z_sw: 0, name: "SW(1,0,0)"},
                {x_sw: 0, y_sw: 1, z_sw: 0, name: "SW(0,1,0)"},
                {x_sw: 0, y_sw: 0, z_sw: 1, name: "SW(0,0,1)"},
                {x_sw: 1, y_sw: 1, z_sw: 1, name: "SW(1,1,1)"},
                {x_sw: 5.5, y_sw: 3.2, z_sw: 2.8, name: "SW(5.5,3.2,2.8)"}
            ];

            let html = '<table><tr><th>–í—Ö–æ–¥–Ω–∏ SW</th><th>–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä–∞–Ω–∏ M</th><th>–ï–¥–Ω–∞–∫–≤–∏?</th></tr>';
            let allSame = true;

            testPoints.forEach(p => {
                // –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è SW -> M
                const M11 = -0.1747159967, M12 = 0.6235799837, M13 = -0.1867561927;
                const M21 = 0.3122687596, M22 = -0.1413437982, M23 = 0.8581431812;
                const M31 = 0.8697589148, M32 = -0.1087945740, M33 = -0.4267759731;
                
                const xM = M11 * p.x_sw + M12 * p.y_sw + M13 * p.z_sw;
                const yM = M21 * p.x_sw + M22 * p.y_sw + M23 * p.z_sw;
                const zM = M31 * p.x_sw + M32 * p.y_sw + M33 * p.z_sw;

                const same = (Math.abs(p.x_sw - xM) < 0.001 && 
                             Math.abs(p.y_sw - yM) < 0.001 && 
                             Math.abs(p.z_sw - zM) < 0.001);
                
                if (!same) allSame = false;

                html += `<tr>
                    <td>${p.name}</td>
                    <td>M(${xM.toFixed(4)}, ${yM.toFixed(4)}, ${zM.toFixed(4)})</td>
                    <td style="background: ${same ? '#d4edda' : '#f8d7da'}">${same ? '‚úì –î–ê' : '‚úó –ù–ï'}</td>
                </tr>`;
            });

            html += '</table>';

            if (!allSame) {
                html += '<div class="difference">‚ö†Ô∏è <strong>SW –∏ M –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏—Ç–µ –°–ï –†–ê–ó–õ–ò–ß–ê–í–ê–¢!</strong> Wrapper —Ñ—É–Ω–∫—Ü–∏—è—Ç–∞ –ï –ù–ï–û–ë–•–û–î–ò–ú–ê!</div>';
            } else {
                html += '<div class="same">‚úì SW –∏ M –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏—Ç–µ —Å–∞ –µ–¥–Ω–∞–∫–≤–∏. Wrapper —Ñ—É–Ω–∫—Ü–∏—è—Ç–∞ –ù–ï –ï –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞.</div>';
            }

            document.getElementById('test1').innerHTML = html;
            return !allSame;
        }

        // –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—Ç–∞ –º–∞—Ç—Ä–∏—Ü–∞
        function test2() {
            let html = '<p>–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—Ç–∞ –º–∞—Ç—Ä–∏—Ü–∞ SW ‚Üí M:</p>';
            html += '<div class="result">';
            html += 'M11 = -0.1747159967, M12 =  0.6235799837, M13 = -0.1867561927<br>';
            html += 'M21 =  0.3122687596, M22 = -0.1413437982, M23 =  0.8581431812<br>';
            html += 'M31 =  0.8697589148, M32 = -0.1087945740, M33 = -0.4267759731';
            html += '</div>';
            
            html += '<p>–ê–∫–æ —Ç–æ–≤–∞ –±–µ—à–µ –µ–¥–∏–Ω–∏—á–Ω–∞ –º–∞—Ç—Ä–∏—Ü–∞ (–¥–∏–∞–≥–æ–Ω–∞–ª –æ—Ç 1-—Ü–∏), SW = M:</p>';
            html += '<div class="result">';
            html += '1  0  0<br>';
            html += '0  1  0<br>';
            html += '0  0  1';
            html += '</div>';
            
            html += '<div class="difference">‚ö†Ô∏è –ú–∞—Ç—Ä–∏—Ü–∞—Ç–∞ –ù–ï –ï –µ–¥–∏–Ω–∏—á–Ω–∞ ‚Üí SW ‚â† M ‚Üí <strong>Wrapper –µ –Ω–µ–æ–±—Ö–æ–¥–∏–º!</strong></div>';

            document.getElementById('test2').innerHTML = html;
        }

        // –¢–µ—Å—Ç 3: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –Ω–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ —Å –∏ –±–µ–∑ wrapper
        function test3() {
            const l = 85, d = 5.7;
            const theta = DrillAngleCalculator.deg2rad(61);
            const beta = DrillAngleCalculator.deg2rad(24);
            
            // –¢–µ—Å—Ç–æ–≤–∏ SW –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏
            const x_sw = 5.5, y_sw = 3.2, z_sw = 2.8;

            let html = '<p><strong>–ü–∞—Ä–∞–º–µ—Ç—Ä–∏:</strong> l=85, d=5.7, Œ∏=61¬∞, Œ≤=24¬∞</p>';
            html += `<p><strong>SW –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏:</strong> (${x_sw}, ${y_sw}, ${z_sw})</p>`;

            try {
                // –í–∞—Ä–∏–∞–Ω—Ç 1: –î–∏—Ä–µ–∫—Ç–Ω–æ —Å—ä—Å SW –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ (–≥—Ä–µ—à–Ω–æ - –∞–∫–æ –≥–∏ –ø–æ–¥–∞–¥–µ–º –∫–∞—Ç–æ M)
                const result1 = DrillAngleCalculator.calculateAngle(l, d, theta, beta, x_sw, y_sw, z_sw);
                
                // –í–∞—Ä–∏–∞–Ω—Ç 2: –ß—Ä–µ–∑ wrapper (–ø—Ä–∞–≤–∏–ª–Ω–æ - —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä–∞ SW -> M)
                const result2 = DrillAngleCalculator.calculateAngleFromSW(l, d, theta, beta, x_sw, y_sw, z_sw);

                html += '<table>';
                html += '<tr><th>–ú–µ—Ç–æ–¥</th><th>Œ±<sub>f</sub> (–≥—Ä–∞–¥—É—Å–∏)</th><th>h (–º–º)</th><th>x<sub>M</sub> (–º–º)</th></tr>';
                html += `<tr>
                    <td>–î–∏—Ä–µ–∫—Ç–Ω–æ (–±–µ–∑ wrapper)</td>
                    <td>${result1.alphaRAD.toFixed(4)}¬∞</td>
                    <td>${result1.h.toFixed(4)}</td>
                    <td>${result1.xM.toFixed(4)}</td>
                </tr>`;
                html += `<tr style="background: #d4edda">
                    <td><strong>–° wrapper (–ø—Ä–∞–≤–∏–ª–Ω–æ)</strong></td>
                    <td>${result2.alphaRAD.toFixed(4)}¬∞</td>
                    <td>${result2.h.toFixed(4)}</td>
                    <td>${result2.xM.toFixed(4)}</td>
                </tr>`;
                html += '</table>';

                const diff = Math.abs(result1.alphaRAD - result2.alphaRAD);
                if (diff > 0.001) {
                    html += `<div class="difference">‚ö†Ô∏è <strong>–†–ê–ó–õ–ò–ö–ê –í –†–ï–ó–£–õ–¢–ê–¢–ò–¢–ï: ${diff.toFixed(4)}¬∞</strong><br>`;
                    html += 'Wrapper —Ñ—É–Ω–∫—Ü–∏—è—Ç–∞ –ï –ê–ë–°–û–õ–Æ–¢–ù–û –ù–ï–û–ë–•–û–î–ò–ú–ê –∑–∞ –ø—Ä–∞–≤–∏–ª–Ω–∏ –∏–∑—á–∏—Å–ª–µ–Ω–∏—è —Å—ä—Å SW –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏!</div>';
                } else {
                    html += '<div class="same">‚úì –†–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ —Å–∞ –µ–¥–Ω–∞–∫–≤–∏ (wrapper –Ω–µ –µ –Ω–µ–æ–±—Ö–æ–¥–∏–º)</div>';
                }
            } catch (error) {
                html += `<div class="difference">‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∏–∑—á–∏—Å–ª–µ–Ω–∏–µ: ${error.message}</div>`;
            }

            document.getElementById('test3').innerHTML = html;
        }

        // –¢–µ—Å—Ç 4: –ù—É–ª–µ–≤–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏
        function test4() {
            let html = '<p>–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–ª–∏ (0,0,0) –≤ SW = (0,0,0) –≤ M:</p>';
            
            const M11 = -0.1747159967, M12 = 0.6235799837, M13 = -0.1867561927;
            const M21 = 0.3122687596, M22 = -0.1413437982, M23 = 0.8581431812;
            const M31 = 0.8697589148, M32 = -0.1087945740, M33 = -0.4267759731;
            
            const xM = M11 * 0 + M12 * 0 + M13 * 0;
            const yM = M21 * 0 + M22 * 0 + M23 * 0;
            const zM = M31 * 0 + M32 * 0 + M33 * 0;

            html += `<div class="result">SW(0, 0, 0) ‚Üí M(${xM}, ${yM}, ${zM})</div>`;
            
            if (xM === 0 && yM === 0 && zM === 0) {
                html += '<div class="same">‚úì –ù–∞—á–∞–ª–æ—Ç–æ –Ω–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏—Ç–µ –µ –æ–±—â–æ –∑–∞ –¥–≤–µ—Ç–µ —Å–∏—Å—Ç–µ–º–∏</div>';
            } else {
                html += '<div class="difference">‚ö†Ô∏è –†–∞–∑–ª–∏—á–Ω–æ –Ω–∞—á–∞–ª–æ –Ω–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏—Ç–µ</div>';
            }

            document.getElementById('test4').innerHTML = html;
        }

        // –ò–∑–ø—ä–ª–Ω–µ–Ω–∏–µ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–µ—Ç–µ
        window.onload = function() {
            const needsWrapper = test1();
            test2();
            test3();
            test4();

            // –ó–∞–∫–ª—é—á–µ–Ω–∏–µ
            const conclusion = document.getElementById('conclusion');
            if (needsWrapper) {
                conclusion.innerHTML = `
                    <h2>üìã –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï:</h2>
                    <p>‚úÖ Wrapper —Ñ—É–Ω–∫—Ü–∏—è—Ç–∞ <code>calculateAngleFromSW()</code> –ï –ù–ï–û–ë–•–û–î–ò–ú–ê!</p>
                    <p><strong>–ó–∞—â–æ?</strong></p>
                    <ul>
                        <li>SW –∏ M —Å–∞ —Ä–∞–∑–ª–∏—á–Ω–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–Ω–∏ —Å–∏—Å—Ç–µ–º–∏</li>
                        <li>–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—Ç–∞ –º–∞—Ç—Ä–∏—Ü–∞ –ù–ï –µ –µ–¥–∏–Ω–∏—á–Ω–∞</li>
                        <li>–î–∏—Ä–µ–∫—Ç–Ω–æ—Ç–æ –∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ –Ω–∞ SW –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –≤–æ–¥–∏ –¥–æ –ì–†–ï–®–ù–ò —Ä–µ–∑—É–ª—Ç–∞—Ç–∏</li>
                        <li>Wrapper-—ä—Ç –ø—Ä–∞–≤–∏ –ø—Ä–∞–≤–∏–ª–Ω–∞—Ç–∞ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è SW ‚Üí M –ø—Ä–µ–¥–∏ –∏–∑—á–∏—Å–ª–µ–Ω–∏–µ</li>
                    </ul>
                    <p><strong>–ö—ä–¥–µ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞:</strong> –í –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—Ç–∞ —Ñ–æ—Ä–º–∞ –∑–∞ —Ä–∞–±–æ—Ç–∞ —Å—ä—Å SW –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏</p>
                `;
            } else {
                conclusion.innerHTML = `
                    <h2>üìã –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï:</h2>
                    <p>‚ùå Wrapper —Ñ—É–Ω–∫—Ü–∏—è—Ç–∞ –ù–ï –ï –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ (SW = M)</p>
                `;
            }
        };
    </script>
</body>
</html>
